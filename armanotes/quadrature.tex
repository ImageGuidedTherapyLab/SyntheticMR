\documentclass[]{scrartcl}

\usepackage[cmex10]{amsmath}
\usepackage{amssymb}
\usepackage{breqn}

\usepackage{graphicx}
\graphicspath{{./Figures/}}
\DeclareGraphicsExtensions{.eps}
\usepackage[caption=false,font=normalsize,labelfont=sf,textfont=sf]{subfig}
%\usepackage[caption=false,font=footnotesize]{subfig}
%\usepackage{subfigure}

\usepackage{xparse}
\usepackage{color}

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}

%% Macros
% Math
\DeclareDocumentCommand \p {R(){}} {\left(#1\right)}
\DeclareDocumentCommand \b {R[]{}} {\left[#1\right]}
\DeclareDocumentCommand \br {m} {\left\{#1\right\}}
\DeclareDocumentCommand \a {R||{}} {\left\lvert#1\right\rvert}
\DeclareDocumentCommand \n {R||{}} {\left\lVert#1\right\rVert}

\newcommand{\expect}[1]{\mathrm{E}\left[#1\right]}
\newcommand{\reop}[1]{\operatorname{Re}\paren{#1}}
\newcommand{\imop}[1]{\operatorname{Im}\paren{#1}}
\newcommand{\deriv}[2]{\frac{d#1}{d#2}}
\newcommand{\pderiv}[2]{\frac{\partial#1}{\partial#2}}
\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\bracket}[1]{\left[#1\right]}
\newcommand{\braced}[1]{\left\{#1\right\}}
\newcommand{\bars}[1]{\lvert #1 \rvert}
\newcommand{\arr}[2]{\begin{array}{#1} #2 \end{array}}
\newcommand{\parenarray}[2]{\paren{\arr{#1}{#2}}}
\newcommand{\brkarray}[2]{\bracket{\arr{#1}{#2}}}
\newcommand{\brcarray}[2]{\braced{\arr{#1}{#2}}}
\newcommand{\lbrcarray}[2]{\left\{\arr{#1}{#2}\right.}
\newcommand{\rbrcarray}[2]{\left.\arr{#1}{#2}\right\}}

% Environments
\DeclareDocumentCommand \eq {sO{}o+m} {\IfBooleanTF #1
	{\begin{dmath*}[#2] #4 \end{dmath*}}
	{\begin{dmath}[#2]\IfNoValueTF{#3}{}{\label{#3}} #4 \end{dmath}}
}

\DeclareDocumentCommand \gr {sO{}o+m} {\IfBooleanTF #1
	{\begin{dgroup*}[#2] #4 \end{dgroup*}}
	{\begin{dgroup}[#2]\IfNoValueTF{#3}{}{\label{#3}} #4 \end{dgroup}}
}

\DeclareDocumentCommand \cnd {sO{,}+m} {\IfBooleanTF #1
	{\condition*[#2]{#3}}
	{\condition[#2]{#3}}	
}

\DeclareDocumentCommand \hr {m} {\hiderel{#1}}

\DeclareDocumentCommand \tbl {m+m} {\begin{tabular}{#1} #2 \end{tabular}}

\DeclareDocumentCommand \mktable {sO{}O{}om+m} {\IfBooleanTF #1
	{\begin{table*}[#2]\centering\caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\begin{tabular}{#5} #6 \end{tabular}\end{table*}}
	{\begin{table}[#2]\centering\caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\begin{tabular}{#5} #6 \end{tabular}\end{table}}
}

\DeclareDocumentCommand \mktableb {sO{}O{}om+m} {\IfBooleanTF #1
	{\begin{table*}[#2]\centering\caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\begin{tabular}{#5} #6 \end{tabular}\end{table*}}
	{\begin{table}[#2]\centering\caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\begin{tabular}{#5} #6 \end{tabular}\end{table}}
}

\DeclareDocumentCommand \mkfig {sO{}O{}O{}om} {\IfBooleanTF #1
	{\begin{figure*}[#2]\centering\includegraphics[#3]{#6}\caption{#4}\IfNoValueTF{#5}{}{\label{#5}}\end{figure*}}
	{\begin{figure}[#2]\centering\includegraphics[#3]{#6}\caption{#4}\IfNoValueTF{#5}{}{\label{#5}}\end{figure}}
}

\DeclareDocumentCommand \figenv {sO{}O{}o+m} {\IfBooleanTF #1
	{\begin{figure*}[#2]\centering #5 \caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\end{figure*}}
	{\begin{figure}[#2]\centering #5 \caption{#3}\IfNoValueTF{#4}{}{\label{#4}}\end{figure}}
}

\DeclareDocumentCommand \subfig {sO{}O{}O{}om} {\IfBooleanTF #1
	{\subfloat[#2]{\includegraphics[#3]{#6}}}
	{\subfloat[#2][#4]{\IfNoValueTF{#5}{}{\label{#5}}\includegraphics[#3]{#6}}}
}

%\DeclareDocumentCommand \subfig {sO{}O{}O{}om} {\IfBooleanTF #1
%	{\begin{subfigure}[#2]\includegraphics[#3]{#6}\end{subfigure}}
%	{\begin{subfigure}[#2]\IfNoValueTF{#5}{}{\label{#5}}\includegraphics[#3]{#6}\caption{#4}\end{subfigure}}
%}

% Writing Symbols
\newcommand{\eg}{\textit{e.g.}\ }
\newcommand{\ie}{\textit{i.e.}\ }

% Math Symbols
\newcommand{\R}{\mathbb{R}}
\newcommand{\Nscript}{\mathcal{N}}
\newcommand{\CNscript}{\mathcal{CN}}
\newcommand{\im}{\mathrm{i}}
\newcommand{\intinfty}{\int\limits_{-\infty}^\infty}
\newcommand{\prodin}{\prod\limits_{i=1}^N}
\newcommand{\prodnn}{\prod\limits_{n=1}^N}
\newcommand{\sumin}{\sum\limits_{i=1}^N}
\newcommand{\sumkn}{\sum\limits_{k=1}^N}
\newcommand{\sumnn}{\sum\limits_{n=1}^N}
\newcommand{\summn}{\sum\limits_{m=1}^N}
\newcommand{\sumpp}{\sum\limits_{p=1}^P}
\newcommand{\sumqq}{\sum\limits_{q=1}^Q}
\newcommand{\sumqone}{\sum\limits_{q_1=1}^{Q_1}}
\newcommand{\sumqN}{\sum\limits_{q_N=1}^{Q_N}}
\newcommand{\sumpqn}{\sum\limits_{p=1}^{Q^N}}

% MRI Symbols
%\DeclareDocumentCommand \kspace {s} {\IfBooleanTF #1
%	{\textit{k}-space\xspace}
%	{\textit{k}-space\ }
%}
\DeclareDocumentCommand \ksp {s} {\IfBooleanTF #1
	{\textit{k}-space}
	{\textit{k}-space }
}
\newcommand{\kspace}{\textit{k}-space\ }
\newcommand{\kspacen}{\textit{k}-space}

% Mutual Information Symbols
\newcommand{\kbf}{\mathbf{k}}
\newcommand{\mbf}{\mathbf{m}}
\newcommand{\Pbf}{\mathbf{P}}
\newcommand{\Rbf}{\mathbf{R}}
\newcommand{\Vbf}{\mathbf{V}}
\newcommand{\xbf}{\mathbf{x}}
\newcommand{\Xbf}{\mathbf{X}}
\newcommand{\Ybf}{\mathbf{Y}}
\newcommand{\zbf}{\mathbf{z}}
\newcommand{\Zbf}{\mathbf{Z}}
\newcommand{\mubf}{\boldsymbol{\mu}}
\newcommand{\nubf}{\boldsymbol{\nu}}
\newcommand{\Gammabf}{\mathbf{\Gamma}}
\newcommand{\Cbf}{\mathbf{C}}
\newcommand{\Sigmabf}{\boldsymbol{\Sigma}}
\newcommand{\zcond}{\mathbf{z}\mid\mu}
\newcommand{\zcondbf}{\mathbf{z}\mid\boldsymbol{\mu}}
\newcommand{\signalG}{\mathcal{G}\paren{\mu,\mathbf{k}}}
\newcommand{\Gscript}{\mathcal{G}}

% Formatting Commands
\newcommand{\q}{\qquad}
\newcommand{\qq}{\qquad\qquad}

% Expressions
\newcommand{\normpdf}[3]{\frac{1}{\sqrt{2\pi}#3}\exp\paren{-\frac{\paren{#1-#2}^2}{2#3^2}}}
\newcommand{\CNpdf}[4]{\frac{1}{\pi^k\sqrt{\mathrm{det}\paren{#3}\mathrm{det}\paren{\bar{#3} - \bar{#4}^T#3^{-1}#4}}} \exp\left\{-\frac{1}{2} \paren{\begin{array}{cc}\paren{\bar{#1} - \bar{#2}}^T & \paren{#1 - #2}^T\end{array}} \paren{\begin{array}{cc} #3 & #4 \ \bar{#4}^T & \bar{#3} \end{array}}\paren{\begin{array}{c} #1 - #2 \ \bar{#1} - \bar{#2} \end{array}}\right\}}

% Editing Commands
\DeclareDocumentCommand \todo {m} {\textcolor{red}{\textbf{To do: #1}}}

\DeclareDocumentCommand \todolist {+m} {\textbf{\textcolor{red}{To Do:}\begin{itemize}\color{red} #1 \end{itemize}}}


%opening
\title{Gauss-Hermite Quadrature for Mutual Information}
\author{Drew Mitchell}

\begin{document}

\maketitle

\section{Probability Distribution Definitions}\label{apn:probdistdef}

Calculate mutual information using numerical integration for a complex signal model $\mathbf{z}\left(\mubf,\mathbf{k}\right)$.
\gr*{
	\eq[][eq:signalmodel]{\zbf\p(\mubf,\kbf)=\int_\Omega M\p(\xbf)e^{-s\p(\mubf,\xbf)}e^{-2\pi\im\kbf\cdot\xbf}d\xbf+\nubf=\Gscript\p(\mubf,\kbf)+\nubf}
	
	\eq*{s\p(\mubf,\xbf)=\frac{T_E}{T_2^*\p(\xbf)}+\im\b[2\pi\gamma\alpha B_0T_E\Delta u\p(\mubf,\xbf)+T_E\Delta\omega_0\p(\xbf)]}
	
	\eq*{\nubf\sim\Nscript\p(\mathbf{0},\Sigmabf_\nu)\cnd*{\Sigmabf_\nu=\brkarray{cc}{
				\sigma_{\nu,r}^2 & 0 \\
				0 & \sigma_{\nu,i}^2}}}
}

Therefore, the probability distribution for $p\p(\zbf\mid\mubf)$ is
\eq{p\p(\zbf\mid\mubf)=\Nscript\p(\Gscript\p(\mubf),\Sigmabf_\nu)}

The tissue properties can be described by the following piecewise functions.
\gr*[noalign]{
	\eq[][eq:tissuedef]{\mubf\p(\xbf)=\sumnn\mubf_nU\p(\xbf-\Omega_n)}
	
	\eq*{\bigcup_{n=1}^N\Omega_n=\Omega\cnd*{\Omega_n\cap\Omega_m=\varnothing}}
	
	\eq*{U\p(\xbf-\Omega_n)=\lbrcarray{l}{
			1\cnd*{x\in\Omega_n} \\
			0\cnd{otherwise}}}
}

Assume normal distribution for the model parameter, optical attenuation coefficient $\mubf$.
\eq{p\paren{\mubf} = \mathcal{N}\left(\mbf_\mu,\mathbf{\Sigma}_\mu\right)}
\gr{
	\eq{\mbf_\mu = \brkarray{c}{
			m_{\mu_1} \\
			\vdots \\
			m_{\mu_N}}}
	
	\eq{\Sigmabf_\mu = \brkarray{ccccc}{
			\sigma_{\mu_1} & 0 & \cdots & 0 & 0 \\
			0 & \sigma_{\mu_2} & 0 & \ddots & 0 \\
			\vdots & \ddots & \ddots & \ddots & \vdots \\
			0 & \ddots & 0 & \sigma_{\mu_{N-1}} & 0 \\
			0 & 0 & \cdots & 0 & \sigma_{\mu_N}}}
}

Also of note, because the real and imaginary components of $\zbf$ are assumed independent, the covariance matrix $\Sigmabf_z$ is diagonal, and the following simplification results.
\eq[compact][]{p\paren{\zbf\hr{\mid}\mubf} = \Nscript_\zbf\paren{\Gscript\paren{\mubf},\mathbf{\Sigma}_\nu} = \Nscript_{z_r}\paren{\Gscript_r\paren{\mubf},\mathbf{\Sigma}_\nu}
	\Nscript_{z_i}\paren{\Gscript_i\paren{\mubf},\mathbf{\Sigma}_\nu} = p\paren{z_r\hr{\mid}\mubf}p\paren{z_i\hr{\mid}\mubf}}

Similarly, the various tissue types are independent, and the covariance matrix $\Sigmabf_\mu$ is also diagonal.
\eq[compact][]{p\p(\mubf)=\Nscript_{\mubf}\p(\mbf_\mu,\Sigmabf_\mu)=\prodin\Nscript_{\mu_i}\p(m_{\mu_i},\sigma_{\mu_i})=\prodin p\p(\mu_i)}

\section{Problem Statement}\label{apn:problemstatement}

The most approachable way to solve mutual information is to begin with the difference of entropies definition.
\eq{I\left(\mubf;\zbf\right) = H\left(\zbf\right) - H\left(\zbf\hr{\mid}\mubf\right) 
	= \frac{1}{2}\ln\left(\left(2\pi e\right)^2\cdot\bars{\mathbf{\Sigma}_z}\right) - \frac{1}{2}\ln\left(\left(2\pi e\right)^2\cdot\bars{\mathbf{\Sigma}_\nu}\right)}

Assuming $\sigma_{\nu,r}^2=\sigma_{\nu,i}^2$, then
\eq[compact][]{\bars{\mathbf{\Sigma}_\nu} = \sigma_\nu^2\sigma_\nu^2-0 = \sigma_\nu^4}

Calculation of $\mathbf{\Sigma}_z$ is less straightforward.
%\eq{\mathbf{\Sigma}_z = \left[ \begin{array}{cc}
%		\mathrm{E}\left[\left(z_r - \expect{z_r}\right)^2\right] & \mathrm{E}\left[\left(z_r - \expect{z_r}\right)\left(z_i - \expect{z_i}\right)\right] \\
%		\mathrm{E}\left[\left(z_i - \expect{z_i}\right)\left(z_r - \expect{z_r}\right)\right] & \mathrm{E}\left[\left(z_i - \expect{z_i}\right)^2\right] \end{array} \right]}

\gr*{
	\eq{\Sigmabf_z=\brkarray{cc}{
			\sigma_{rr} & \sigma_{ri} \\
			\sigma_{ir} & \sigma_{ii}}}
	
	\eq*{\sigma_{rr}=\expect{\paren{z_r-\expect{z_r}}^2}}
	
	\eq*{\sigma_{ri}=\expect{\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}}}
	
	\eq*{\sigma_{ir}=\expect{\paren{z_i-\expect{z_i}}\paren{z_r-\expect{z_r}}}}
	
	\eq*{\sigma_{ii}=\expect{\paren{z_i-\expect{z_i}}^2}}
}

%$\expect{z_r}$, $\expect{z_i}$, $\expect{\left(z_r - \expect{z_r}\right)^2}$, $\expect{\left(z_i - \expect{z_i}\right)^2}$, and $\expect{\left(z_r - \expect{z_r}\right)\left(z_i - \expect{z_i}\right)}$ all need to be calculated numerically.

The values of $\sigma_{rr}$, $\sigma_{ri}$, $\sigma_{ir}$, and $\sigma_{ii}$ all need to be calculated numerically.

Alternatively, $\int p(z\mid\mu)p(\mu)$ can probably be calculated analytically using [Bromiley 2003]. The product of three normal distributions is a scaled normal distribution, so after converting $N_{z_i}$ and $N_{z_r}$ to distributions in terms of $\mu$ for the integration, the normal distribution integrates to 1, and the scaling factor comes out as a function of $z_r$ and $z_i$, $S_{fgh}\paren{z_r,z_i}$, for the remaining two integrals. This leaves potentially very difficult numerical integrations at this step.

\section{Gauss-Hermite Quadrature}\label{apn:ghquad}

Gaussian quadrature:

\gr*{
	\eq[][eq:ghquad]{\intinfty\exp^{-x^2}f\paren{x}dx \approx \sumin\omega_if\paren{x_i}}
	\eq*{\omega_i = \frac{2^{n-1}n!\sqrt{\pi}}{n^2\bracket{H_{n-1}\paren{x_i}}^2}}
}

where $n$ is the number of sample points used, $H_n\paren{x}$ is the physicists' Hermite polynomial, $x_i$ are the roots of the Hermite polynomial, and $\omega_i$ are the associated Gauss-Hermite weights.

Substitution for normal distributions using Gauss-Hermite quadrature:

\eq{\expect{h\paren{y}} = \intinfty\frac{1}{\sigma\sqrt{2\pi}}\exp\paren{-\frac{\paren{y-\mu}^2}{2\sigma^2}}h\paren{y}dy}

$h$ is some function of $y$, and random variable $Y$ is normally distributed.

\eq[compact]{x = \frac{y-\mu}{\sqrt{2}\sigma} \Leftrightarrow y = \sqrt{2}\sigma x+\mu}

\eq{\expect{h\p(y)}=\intinfty\frac{1}{\sqrt{\pi}}\exp\p(-x^2)h\p(\sqrt{2}\sigma x+\mu)dx\approx\frac{q}{\sqrt{\pi}}\sumin\omega_i h\p(\sqrt{2}\sigma x_i+\mu)}

%\eq{\expect{h\paren{y}} = \intinfty\frac{1}{\sqrt{\pi}}\exp\paren{-x^2}h\paren{\sqrt{2}\sigma x+\mu}dx}
%
%\eq{\expect{h\paren{y}} \approx \frac{1}{\sqrt{\pi}}\sumin\omega_i h\paren{\sqrt{2}\sigma x_i+\mu}}

\section{Mutual Information Calculation}\label{apn:micalc}

\eq[compact][]{I\p(\mubf;\zbf)=H\p(\zbf)-H\p(\zbf\hr{\mid}\mubf)=\frac{1}{2}\ln\p(\p(2\pi e)^2\cdot\a|\Sigmabf_z|)-\frac{1}{2}\ln\p(\p(2\pi e)^2\cdot\a|\Sigmabf_\nu|)}

%\eq{I\left(\mubf;\zbf\right) = H\left(\zbf\right) - H\left(\zbf\hr{\mid}\mubf\right) = \frac{1}{2}\ln\left(\left(2\pi e\right)^2\cdot\bars{\Sigmabf_z}\right) - \frac{1}{2}\ln\left(\left(2\pi e\right)^2\cdot\bars{\Sigmabf_\nu}\right)}

\eq[compact]{\a|\Sigmabf_\nu|=\sigma_\nu^2\sigma_\nu^2-0=\sigma_\nu^4}

%\eq{\mathbf{\Sigma}_z = \left[ \begin{array}{cc}
%		\mathrm{E}\left[\left(z_r - \expect{z_r}\right)^2\right] & \mathrm{E}\left[\left(z_r - \expect{z_r}\right)\left(z_i - \expect{z_i}\right)\right] \\
%		\mathrm{E}\left[\left(z_i - \expect{z_i}\right)\left(z_r - \expect{z_r}\right)\right] & \mathrm{E}\left[\left(z_i - \expect{z_i}\right)^2\right] \end{array} \right]}

\gr*{
	\eq{\Sigmabf_z=\brkarray{cc}{
			\sigma_{rr} & \sigma_{ri} \\
			\sigma_{ir} & \sigma_{ii}}}
	
	\eq*{\sigma_{rr}=\expect{\p(z_r-\expect{z_r})^2}}
	
	\eq*{\sigma_{ri}=\expect{\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})}}
	
	\eq*{\sigma_{ir}=\expect{\p(z_i-\expect{z_i})\p(z_r-\expect{z_r})}}
	
	\eq*{\sigma_{ii}=\expect{\p(z_i-\expect{z_i})^2}}
}


\eq[compact][]{p\p(\zbf)=\int p\p(\zbf\hr{\mid}\mubf)p\p(\mubf)d\mubf}

%\eq{p\paren{\zbf} = \int p\paren{\zbf\hr{\mid}\mubf}p\paren{\mubf}d\mubf}

\eq[compact][]{p\p(\zbf\hr{\mid}\mubf)=\Nscript_\zbf\p(\mathbf{\Gscript}\p(\mubf),\Sigmabf_\nu)=\Nscript_{z_r}\p(\Gscript_r\p(\mubf),\sigma_\nu)\Nscript_{z_i}\p(\Gscript_i\p(\mubf),\sigma_\nu)=p\p(z_r\hr{\mid}\mubf)p\p(z_i\hr{\mid}\mubf)}

%\eq{p\paren{\zbf\hr{\mid}\mubf} = \Nscript_\zbf\paren{\mathbf{\Gscript}\paren{\mubf},\Sigmabf_\nu} = \Nscript_{z_r}\paren{\Gscript_r\paren{\mubf},\sigma_\nu}\Nscript_{z_i}\paren{\Gscript_i\paren{\mubf},\sigma_\nu} = p\paren{z_r\hr{\mid}\mubf}p\paren{z_i\hr{\mid}\mubf}}

\eq[compact][]{p\p(\mubf)=\Nscript_{\mubf}\p(\mbf_\mu,\Sigmabf_\mu)=\prodin\Nscript_{\mu_i}\p(m_{\mu_i},\sigma_{\mu_i})=\prodin p\p(\mu_i)}

%\eq[compact]{p\paren{\mubf}=\Nscript_{\mubf}\paren{\mbf_\mu,\Sigmabf_\mu}=\prodin\Nscript_{\mu_i}\paren{m_{\mu_i},\sigma_{\mu_i}}=\prodin p\paren{\mu_i}}

The signal measurement probability distribution $p\paren{\zbf}$ can be approximated using Gauss-Hermite quadrature. The calculation is performed separately for the real and imaginary components, $p\paren{z_r}$ and $p\paren{z_i}$, because $z_r$ and $z_i$ are assumed independent.

%\eq[compact][]{p\p(z_r)=\prodin\intinfty p\p(z_r\mid\mubf)p\p(\mu_i)d\mu_i}

\eq[compact][]{p\p(z_r)=\intinfty p\p(z_r\hr{\mid}\mubf)\prodnn p\p(\mu_n)d\mubf=\intinfty p\p(z_r\hr{\mid}\mubf)\prodnn\normpdf{\mu_n}{m_{\mu_n}}{\sigma_{\mu_n}}d\mubf=\intinfty p\p(z_r\hr{\mid}\mubf)\prodnn\frac{1}{\sqrt{\pi}}\exp\p(-x_n^2)d\xbf\approx\pi^{-N/2}\sumpqn\omega_pp\p(z_r\hr{\mid}\mubf_p)}

Q=number of quadrature points; N=number of tissue types

\gr*[noalign]{
	\eq*[compact][]{p\p(z_r\mid\mubf)=p\p(z_r\mid\mu_1,\ldots,\mu_N)}
	
	\eq*[compact][]{p\p(z_r\mid\mubf_p)=p\p(z_r\mid\mu_{1,q},\ldots,\mu_{N,q})}
	
	\eq*[compact][]{d\mubf=d\mu_1\cdots d\mu_N}
	
	\eq*[compact][]{\mu_{i,q}=\sqrt{2}\sigma_{\mu_i}x_{i,q}+m_{\mu_i}}
	
	\eq*[compact][]{d\mu_{i,q}=\sqrt{2}\sigma_{\mu_i}dx_{i,q}}
}

%\gr{
%	\eq{p\paren{z_r} = \intinfty\cdots\intinfty p\paren{z_r\hr{\mid}\mu_1,\cdots,\mu_N}\prodin p\paren{\mu_i}d\mu_1\cdots d\mu_N = \intinfty\cdots\intinfty\prodin\normpdf{\mu_i}{m_{\mu_i}}{\sigma_{\mu_i}}p\paren{z_r\hr{\mid}\mu_1,\cdots,\mu_N}d\mu_1\cdots d\mu_N = \intinfty\cdots\intinfty\prodin\frac{1}{\sqrt{\pi}}\exp\paren{-x_i^2}p\paren{z_r\hr{\mid}\paren{\sqrt{2}\sigma_{\mu_1} x_1+m_{\mu_1},\cdots,\sqrt{2}\sigma_{\mu_N} x_N+m_{\mu_N}}}dx_1\cdots dx_N \approx \pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_r\hr{\mid}\paren{\sqrt{2}\sigma_{\mu_1} x_1+m_{\mu_1},\cdots,\sqrt{2}\sigma_{\mu_N} x_N+m_{\mu_N}}} = \pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_r\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}}
%
%	\eq[compact][]{\mu_{i,q}=\sqrt{2}\sigma_{\mu_i}x_{i,q}+m_{\mu_i}}

%	\eq{\lbrcarray{l}{
%		\mu_{1,q}=\sqrt{2}\sigma_{\mu_1}x_{1,q}+m_{\mu_1} \\
%		\vdots \\
%		\mu_{N,q}=\sqrt{2}\sigma_{\mu_N}x_{N,q}+m_{\mu_N}}}
%}

An identical calculation for the imaginary component results in

\gr*{
	\eq{p\p(z_i)\approx\pi^{-N/2}\sumin\sumqq\omega_{i,q}p\p(z_i\hr{\mid}\mubf_p)}	
	
	\eq*[compact][]{p\p(z_i\mid\mubf_p)=p\p(z_i\mid\mu_{1,q},\ldots,\mu_{N,q})}
	
	\eq*[compact][]{\mu_{i,q}=\sqrt{2}\sigma_{\mu_i}x_{i,q}+m_{\mu_i}}
}

%\gr{
%	\eq{p\paren{z_i}=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_i\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}}
%
%	\eq[compact][]{\mu_{i,q}=\sqrt{2}\sigma_{\mu_i}x_{i,q}+m_{\mu_i}}
%
%%	\eq{\lbrcarray{l}
%%		{\mu_{1,q}=\sqrt{2}\sigma_{\mu_1}x_{1,q}+m_{\mu_1} \\ \vdots \\ \mu_{N,q}=\sqrt{2}\sigma_{\mu_N}x_{N,q}+m_{\mu_N}}}
%}

Calculate expectation values for real and imaginary components by definition and approximating $p\paren{\zbf}$ with Gauss-Hermite quadrature as shown above.

\eq[compact][]{\expect{z_r}=\intinfty z_rp\p(z_r)dz_r\approx\intinfty z_r\pi^{-N/2}\sumpqn\omega_pp\p(z_r\hr{\mid}\mubf_p)dz_r=\pi^{-N/2}\sumpqn\omega_p\intinfty z_rp\p(z_r\hr{\mid}\mubf_p)dz_r=\pi^{-N/2}\sumpqn\omega_p\expect{z_r\hr{\mid}\mubf_p}=\pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)}

%\eq{\expect{z_r} = \int z_r p\paren{z_r}dz_r \approx \int z_r\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_r\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}dz_r=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int z_rp\paren{z_r\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}dz_r=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\expect{z_r\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}}

Similarly for the imaginary component,

\eq[compact][]{\expect{z_i}\approx\pi^{-N/2}\sumpqn\omega_p\Gscript_i\p(\mubf_p)}

%\eq{\expect{z_i} \approx \pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\expect{z_i\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}} = \pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}}

The variance can be calculated as follows:

\eq[compact][]{\expect{\p(z_r-\expect{z_r})^2}=\expect{z_r^2}-\p(\expect{z_r})^2=\intinfty z_r^2p\p(z_r)dz_r-\p(\expect{z_r})^2\approx\intinfty z_r^2\pi^{-N/2}\sumpqn\omega_pp\p(z_r\hr{\mid}\mubf_p)dz_r-\p(\expect{z_r})^2=\pi^{-N/2}\sumpqn\omega_p\intinfty z_r^2p\p(z_r\hr{\mid}\mubf_p)dz_r-\p(\expect{z_r})^2=\pi^{-N/2}\sumpqn\omega_p\\\cdot\intinfty z_r^2\normpdf{z_r}{\Gscript_r\p(\mubf_p)}{\sigma_\nu}dz_r-\p(\expect{z_r})^2=\pi^{-N/2}\sumpqn\omega_p\intinfty\p(x^2\sigma_\nu^2+2x\sigma_\nu\Gscript_r\p(\mubf_p)+\Gscript_r^2\p(\mubf_p))\\\cdot\frac{1}{\sqrt{2\pi}}\exp\p(-\frac{x^2}{2})dx-\p(\expect{z_r})^2=\pi^{-N/2}\sumpqn\omega_p\p(\sigma_\nu^2+\Gscript_r^2\p(\mubf_p))-\p(\expect{z_r})^2=\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_r^2\p(\mubf_p)-\p(\expect{z_r})^2}

%\gr{
%	\eq{\expect{\paren{z_r-\expect{z_r}}^2}=\expect{z_r^2}-\paren{\expect{z_r}}^2=\int z_r^2p\paren{z_r}dz_r-\paren{\expect{z_r}}^2\approx\int z_r^2\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_r|\mu_{1,q},\cdots,\mu_{N,q}}dz_r-\paren{\expect{z_r}}^2=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int z_r^2p\paren{z_r|\mu_{1,q},\cdots,\mu_{N,q}}dz_r-\paren{\expect{z_r}}^2=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int z_r^2\normpdf{z_r}{\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}}{\sigma_\nu}dz_r-\paren{\expect{z_r}}^2=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int\paren{x^2\sigma_\nu^2+2x\sigma_\nu\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}+\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}}\qq\qq\cdot\frac{1}{\sqrt{2\pi}}\exp\paren{-\frac{x^2}{2}}dx-\paren{\expect{z_r}}^2=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\paren{\sigma_\nu^2+\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}}-\paren{\expect{z_r}}^2=\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_r}}^2}
%
%	\eq{\lbrcarray{l}
%		{\mu_{1,q}=\sqrt{2}\sigma_{\mu_1}x_{1,q}+m_{\mu_1} \\ \vdots \\
%		\mu_{N,q}=\sqrt{2}\sigma_{\mu_N}x_{N,q}+m_{\mu_N}}}
%}

Again, an identical calculation for the imaginary component yields

\eq[compact][]{\expect{\p(z_i-\expect{z_i})^2}=\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_i^2\p(\mubf_p)-\p(\expect{z_i})^2}

%\gr{
%	\eq{\expect{\paren{z_i-\expect{z_i}}^2} = \pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_i^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_i}}^2}	
%
%	\eq{\lbrcarray{l}
%		{\mu_{1,q}=\sqrt{2}\sigma_{\mu_1}x_{1,q}+m_{\mu_1} \\ \vdots \\ 
%		\mu_{N,q}=\sqrt{2}\sigma_{\mu_N}x_{N,q}+m_{\mu_N}}}
%}

The off-diagonal elements of $\Sigma_z$ are equal.

\eq[compact][]{\expect{\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})}=\expect{\p(z_i-\expect{z_i})\p(z_r-\expect{z_r})}}

%\eq{\expect{\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}} = \expect{\paren{z_i-\expect{z_i}}\paren{z_r-\expect{z_r}}}}

\eq[][]{\expect{\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})}=\intinfty\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})p\p(\zbf)d\zbf=\intinfty\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})\intinfty p\p(\zbf\hr{\mid}\mubf)p\p(\mubf)d\mubf d\zbf\approx\intinfty\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})\cdot\pi^{-N/2}\sumpqn\omega_pp\p(\zbf\hr{\mid}\mubf_p)d\zbf=\pi^{-N/2}\sumpqn\omega_p\intinfty\p(z_r-\expect{z_r})p\p(z_r\hr{\mid}\mubf_p)dz_r\\\cdot\intinfty\p(z_i-\expect{z_i})p\p(z_i\hr{\mid}\mubf_p)dz_i=\pi^{-N/2}\sumpqn\omega_p\\\cdot\intinfty\p(z_r-\expect{z_r})\normpdf{z_r}{\Gscript_r\p(\mubf_p)}{\sigma_\nu}dz_r\\\cdot\intinfty\p(z_i-\expect{z_i})\normpdf{z_i}{\Gscript_i\p(\mubf_p)}{\sigma_\nu}dz_i=\pi^{-N/2}\sumpqn\omega_p\\\cdot\intinfty\p(\sigma_\nu x+\Gscript_r\p(\mubf_p)-\expect{z_r})\frac{1}{\sqrt{2\pi}}\exp\p(-\frac{x^2}{2})dx\\\cdot\intinfty\p(\sigma_\nu y+\Gscript_i\p(\mubf_p)-\expect{z_i})\frac{1}{\sqrt{2\pi}}\exp\p(-\frac{y^2}{2})dy=\pi^{-N/2}\sumpqn\omega_p\p(\p(\Gscript_r\p(\mubf_p)-\expect{z_r})\p(\Gscript_i\p(\mubf_p)-\expect{z_i}))=\pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)\Gscript_i\p(\mubf_p)-\expect{z_r}\expect{z_i}}

%=\intinfty\p(z_r-\expect{z_r})\p(z_i-\expect{z_i})\cdot\pi^{-N/2}\sumpqn\omega_pp\p(z_r\hr{\mid}\mubf_p)p\p(z_i\hr{\mid}\mubf_p)d\zbf

%\eq[compact][]{\expect{\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}}=\int\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}p\paren{\zbf}d\zbf= \int\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}\int p\paren{\zbf\hr{\mid}\mubf}p\paren{\mubf}d\zbf\approx\int\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{\zbf\hr{\mid}\mu_{1,q},\cdots,\mu_{N,q}}d\zbf=\int\paren{z_r-\expect{z_r}}\paren{z_i-\expect{z_i}}\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}p\paren{z_r|\mu_{1,q},\cdots,\mu_{N,q}}p\paren{z_i|\mu_{1,q},\cdots,\mu_{N,q}}d\zbf=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int\paren{z_r-\expect{z_r}}p\paren{z_r|\mu_{1,q},\cdots,\mu_{N,q}}dz_r\cdot\int\paren{z_i-\expect{z_i}}p\paren{z_i|\mu_{1,q},\cdots,\mu_{N,q}}dz_i=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\int\paren{z_r-\expect{z_r}}\normpdf{z_r}{\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}}{\sigma_\nu}dz_r\cdot\int\paren{z_i-\expect{z_i}}\normpdf{z_i}{\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}}{\sigma_\nu}dz_i=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\\\int\paren{\sigma_\nu x+\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}}\frac{1}{\sqrt{2\pi}}\exp\paren{-\frac{x^2}{2}}dx\\\cdot\int\paren{\sigma_\nu y+\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_i}}\frac{1}{\sqrt{2\pi}}\exp\paren{-\frac{y^2}{2}}dy=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\paren{\paren{\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\\-\expect{z_r}}\paren{\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_i}}}=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\paren{\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\expect{z_i}-\\\cdot\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}\expect{z_r}+\expect{z_r}\expect{z_i}}=\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\\\cdot\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i}}

%\ml{\Sigma_z = \left[ \begin{array}{cc}
%\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_r}}^2 & \pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i} \\
%\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i} & \pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_i^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_i}}^2
%\end{array} \right]}

Thus, the numerical approximation to the covariance matrix $\Sigmabf_z$ is then

%\eq[compact][]{\Sigma_z=\brkarray{cc}{
%		\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_r^2\p(\mubf_p)-\p(\expect{z_r})^2 & \pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)\Gscript_i\p(\mubf_p)-\expect{z_r}\expect{z_i} \\
%		\pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)\Gscript_i\p(\mubf_p)-\expect{z_r}\expect{z_i} &
%		\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_i^2\p(\mubf_p)-\p(\expect{z_i})^2}}

\gr*{
	\eq{\Sigmabf_z=\brkarray{cc}{
			\sigma_{rr} & \sigma_{ri} \\
			\sigma_{ir} & \sigma_{ii}}}
	
	\eq*{\sigma_{rr}=\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_r^2\p(\mubf_p)-\p(\expect{z_r})^2}
	\eq*{\sigma_{ii}=\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_i^2\p(\mubf_p)-\p(\expect{z_i})^2}
	\eq*{\sigma_{ri}=\sigma_{ir}=\pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)\Gscript_i\p(\mubf_p)-\expect{z_r}\expect{z_i}}
}

%\eq{\Sigma_z=\bracket{\arr{c}{\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\\\cdots\sumqN\omega_{q_N}\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_r}}^2\pi^{-N/2}\sumqone\omega_{q_1}\\\cdots\sumqN\omega_{q_N}\\\cdot\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\\\cdot \Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i}}\\new\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\\\cdot\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i}\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_i^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_i}}^2}}

The determinant of the covariance matrix is easily calculated.

\eq[compact][]{\a|\Sigmabf_z|=\p(\pi^{N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_r^2\p(\mubf_p)-\p(\expect{z_r})^2)\cdot\p(\pi^{N/2}\sigma_\nu^2+\pi^{-N/2}\sumpqn\omega_p\Gscript_i^2\p(\mubf_p)-\p(\expect{z_i})^2)\\-\p(\pi^{-N/2}\sumpqn\omega_p\Gscript_r\p(\mubf_p)\Gscript_i\p(\mubf_p)-\expect{z_r}\expect{z_i})^2}

%\eq{\bars{\Sigmabf_z}=\paren{\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_r^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\paren{\expect{z_r}}^2}\cdot\paren{\pi^{-N/2}\sigma_\nu^2+\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\Gscript_i^2\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\\\paren{\expect{z_i}}^2}-\\\paren{\pi^{-N/2}\sumqone\omega_{q_1}\cdots\sumqN\omega_{q_N}\\\cdot\Gscript_r\paren{\mu_{1,q},\cdots,\mu_{N,q}}\Gscript_i\paren{\mu_{1,q},\cdots,\mu_{N,q}}-\expect{z_r}\expect{z_i}}^2}

The mutual information calculation is straightforward once the value of $\bars{\Sigmabf_z}$ is known.

\eq[compact][]{I\p(\mubf;\zbf)=H\p(\zbf)-H\p(\zbf\hr{\mid}\mubf)=\frac{1}{2}\ln\p(\p(2\pi e)^2\cdot\a|\Sigmabf_z|)-\frac{1}{2}\ln\p(\p(2\pi e)^2\cdot\a|\Sigmabf_\nu|)}

\end{document}
